<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yayiabc.http.mvc.dao.UserPersonalInfoDao">
	<resultMap type="UserPersonalInfo" id="userPersonalInfoRM">
		<id column="user_id" property="userId"/>
		<result column="phone" property="phone"/>
		<result column="true_name" property="trueName"/>
		<result column="sex" property="sex"/>
		<result column="birthday" property="birthday"/>
		<result column="qq" property="qq"/>
		<result column="user_pic" property="userPic"/>
		<result column="type" property="type"/>
		<result column="company_name" property="companyName"/>
		<result column="part" property="part"/>
		<result column="work_address" property="workAddress"/>
		<result column="doctor_pic" property="doctorPic"/>
		<result column="state" property="state"/>
		<result column="fail_reason" property="failReason"/>
		<result column="judge" property="judge"/>
	</resultMap>
	
	<select id="detail" resultMap="userPersonalInfoRM">
		SELECT u.phone,u.true_name,u.sex,u.birthday,u.qq,u.user_pic,c.type,c.company_name,c.part,c.work_address,c.doctor_pic,c.state,c.fail_reason,c.judge
		FROM USER u 
		LEFT JOIN certification c 
		ON u.user_id=c.user_id 
		WHERE u.user_id = #{userId}
	</select>
	
	<select id="getUserIdOnC" resultType="String">	
		SELECT user_id FROM certification WHERE user_id=#{userId};
	</select>
	
	<insert id="add">
		INSERT certification(user_id,created)
		VALUES(#{userId},NOW());
	</insert>
	
	<update id="updateUser">
		UPDATE user
		<set>
			<if test="trueName !=null">true_name=#{trueName},</if>
			<if test="sex !=null">sex=#{sex},</if>
			<if test="birthday !=null">birthday=#{birthday},</if>
			<if test="qq !=null">qq=#{qq},</if>
			<if test="userPic !=null">user_pic=#{userPic}</if>
		</set>
		WHERE user_id=#{userId};
	</update>
	
	<update id="updateCertification">
		UPDATE certification
		<set>
			<if test="type != null">type=#{type},</if>
			<if test="companyName != null">company_name=#{companyName},</if>
			<if test="part != null">part=#{part},</if>
			<if test="workAddress != null">work_address=#{workAddress},</if>
			<if test="doctorPic != null">doctor_pic=#{doctorPic},</if>
			<if test="judge !=null">judge=#{judge},</if>
			state=1,fail_reason=NULL
		</set>
		WHERE user_id=#{userId};
	</update>
</mapper>