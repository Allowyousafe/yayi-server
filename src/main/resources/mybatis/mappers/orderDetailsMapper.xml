<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yayiabc.http.mvc.dao.OrderDetailsDao">

	<resultMap type="User" id="userMap" autoMapping="true">
		<id column="user_id" property="userId" jdbcType="VARCHAR" />
		<association property="certification" javaType="Certification">
			<id property="certificationId" column="certification_id" />
		</association>
		<collection property="receiverList" ofType="list">
			<id property="receiverId" column="tag_id" />
		</collection>
	</resultMap>
	<select id="getUserByUser" resultMap="userMap">
		select * from user where
		phone=#{phone}
	</select>
	<!-- 开始 -->
	<resultMap type="User" id="orderDetailsResultMap">
		<id property="userId" column="user_id" />
		<!-- 订单表 -->
		<collection property="orderaList" ofType="Ordera">
			<id property="orderId" column="order_id" />
			<result property="shippingCode" column="shipping_code" />
			<result property="created" column="created" />
			<result property="state" column="state" />
			<result property="actualPay" column="actual_pay" />
			<result property="qbDed" column="qb_ded" />
				<result property="totalFee" column="total_fee" />
			<!-- //订单商品表 -->
			<collection property="orderitemList" ofType="OrderItem">
				<id property="itemId" column="item_id" />
				<result property="picPath" column="pic_path" />
				<result property="num" column="num" />
				<result property="price" column="price" />
				<result property="itemId" column="order_item" />
				<result property="itemPropertyNamea" column="item_property_namea" />
				<result property="itemPropertyNameb" column="item_property_nameb" />
				<result property="itemPropertyNamec" column="item_property_namec" />

				<!-- 商品表 信息表 -->
				<association property="itemInfo"
					javaType="com.yayiabc.http.mvc.pojo.jpa.ItemInfo">
					<id property="itemId" column="item_id" />
					<result property="itemName" column="item_name" />
					<!-- 商品属性表 -->
					<!-- <association property="itemPnamea" javaType="com.yayiabc.http.mvc.pojo.jpa.ItemProperty"> 
						<id property="itemPropertyId" column="item_property_id" /> <result property="itemPropertyName" 
						column="item_property_name" /> <商品属性详情表 <collection property="itempropertydList" 
						ofType="ItemPropertyd"> <id property="itemPdid" column="item_pdid" /> <result 
						property="itemPparam" column="item_pparam" /> </collection> </association> 
						test1 start 商品属性表 <association property="itemPnameb" javaType="com.yayiabc.http.mvc.pojo.jpa.ItemProperty"> 
						<result property="itemPropertyName" column="item_property_name" /> <商品属性详情表 
						<collection property="itempropertydList" ofType="ItemPropertyd"> <id property="itemPdid" 
						column="item_pdid" /> <result property="itemPparam" column="item_pparam" 
						/> </collection> </association> end test2 start 商品属性表 <association property="itemPnamec" 
						javaType="com.yayiabc.http.mvc.pojo.jpa.ItemProperty"> <result property="itemPropertyName" 
						column="item_property_name" /> <商品属性详情表 <collection property="itempropertydList" 
						ofType="ItemPropertyd"> <id property="itemPdid" column="item_pdid" /> <result 
						property="itemPparam" column="item_pparam" /> </collection> </association> -->
					<!-- end -->
				</association>
			</collection>
		</collection>
	</resultMap>
	<select id="orderDetailsShow" parameterType="java.util.Map"
		resultMap="orderDetailsResultMap">
		SELECT
		orde.order_id,orde.created,orde_it.num,orde_it.price,orde_it.total_fee,orde.actual_pay,
		item_f.item_name,orde_it.pic_path,
		orde_it.item_property_namea,
		orde_it.item_property_nameb,orde_it.item_property_namec,orde_it.item_id,orde.post_fee,orde.qb_ded,orde.state
		FROM
		USER us JOIN
		ordera orde ON us.user_id=orde.user_id JOIN order_item
		orde_it ON
		orde.order_id=orde_it.order_id JOIN
		item_info item_f ON
		orde_it.item_id
		= item_f.item_id
		<where>
			<if test="phone !=null">
				us.user_id=${phone}
			</if>

			<if test="state !=null">
				and orde.state=${state}  <!-- 待付款 -->
			</if>
       
		</where>
		 limit ${currentPage},${numberPerpage}
	</select>
	
	
	<select id="queryCount" parameterType="java.util.Map"
		resultType="int">
		SELECT
		 count(1)
		FROM
		USER us JOIN
		ordera orde ON us.user_id=orde.user_id JOIN order_item
		orde_it ON
		orde.order_id=orde_it.order_id JOIN
		item_info item_f ON
		orde_it.item_id
		= item_f.item_id
		<where>
			<if test="phone !=null">
				us.user_id=${phone}
			</if>

			<if test="state !=null">
				and orde.state=${state}  <!-- 待付款 -->
			</if>
		</where>
	</select>
</mapper>