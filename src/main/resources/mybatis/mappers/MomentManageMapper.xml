<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yayiabc.http.mvc.dao.MomentManageDao">
	<insert id="addLower" parameterType="Moment" useGeneratedKeys="true" keyProperty="momentId">
		insert into moment(user_id,moment_content,moment_picture,moment_type)
		VALUE (#{userId},#{momentContent},#{momentPicture},#{momentType})
	</insert>

	<insert id="addHigh" parameterType="Moment" useGeneratedKeys="true" keyProperty="momentId">
		insert into moment(user_id,moment_content_id,moment_type,moment_content)
		VALUE (#{userId},#{momentContentId},#{momentType},#{momentContent})
	</insert>

	<delete id="deleteMoment">
		delete from moment where moment_id=#{momentId}
	</delete>





	<select id="getMomentTotalNumber" resultType="int">
		select count(*) from moment
		<where>
			<if test="type==2">
				user_id=#{userId}
			</if>
		</where>
	</select>

	<resultMap id="moment" type="Moment" autoMapping="true">
		<id property="momentId" column="moment_id"/>
		<result property="userId" column="user_id"/>
		<result property="userName" column="true_name"/>
		<result property="userPic" column="user_pic"/>
	</resultMap>


	<select id="queryList" resultMap="moment">
		select a.moment_id,b.user_id,b.true_name,b.user_pic,a.moment_content,a.moment_picture,a.moment_content_id,a.moment_type,a.moment_time FROM
		(select * from moment
			<where>
			<if test="type==2">
				user_id=#{userId}
			</if>
		</where>) a
		join user b on a.user_id=b.user_id
		order by a.moment_time DESC
		limit #{page.currentNumber},#{page.numberPerPage}
	</select>

	<select id="getMomentTitleByVedio" resultType="java.util.Map">
		select video_name as contentTitle,vedio_pic AS contentPic from vid_manage where vi_id=#{momentContentId}
	</select>
	
	<select id="getMomentTitleByPost" resultType="java.util.Map">
		select headline as contentTitle,cover as contentPic from cottoms_post where post_id=#{momentContentId}
	</select>
	
	<select id="getMomentTitleByTrain" resultType="java.util.Map">
		select train_name as contentTitle,train_pic AS contentPic from train where train_id=#{momentContentId}
	</select>

	<select id="getUserIdByMomentId" resultType="string">
		select user_id from moment where moment_id=#{beCommentedId}
	</select>










</mapper>       