<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.yayiabc.http.mvc.dao.ItemSearchDao">
	<select id="itemSearch" resultMap="itemInfoRM">
	<bind name="pattern" value="'%' + itemBrandName + '%'" />
		 SELECT d.item_id,d.x_id,d.item_name,d.item_price,d.one_classify,d.sales,d.two_classify,d.three_classify,c.item_brand_name,d.updated FROM
 (SELECT * FROM
 (SELECT item_id,item_name,sales,item_brand_id,item_price,one_classify,two_classify,three_classify,updated FROM item_info) a
 LEFT JOIN
 (SELECT item_id x_id,item_pica FROM item_detail) b
 ON a.item_id=b.x_id) d
 LEFT JOIN
 (SELECT item_brand_id p_id,item_brand_name FROM item_brand) c
 ON d.item_brand_id=c.p_id
 WHERE item_name like #{pattern} or one_classify like #{pattern}
 or two_classify like #{pattern} or three_classify like #{pattern}
 or item_brand_name like #{pattern}
 order by 
    <choose>
    	<when test="rule=1">updated desc</when>
    	<when test="rule=2">sales desc</when>
    	<when test="rule=3">item_price desc</when>
    	<when test="rule=4">item_price aesc</when>
    </choose>
 LIMIT #{currentNumber},#{numberPerPage}
	</select>
	<select id="getCount" resultType="int">
	<bind name="pattern" value="'%' + itemBrandName + '%'" />
		 SELECT count(0) FROM
 (SELECT * FROM
 (SELECT item_id,item_name,item_brand_id,item_price,one_classify,two_classify,three_classify FROM item_info) a
 LEFT JOIN
 (SELECT item_id x_id,item_pica FROM item_detail) b
 ON a.item_id=b.x_id) d
 LEFT JOIN
 (SELECT item_brand_id p_id,item_brand_name FROM item_brand) c
 ON d.item_brand_id=c.p_id
 WHERE item_name like #{pattern} or one_classify like #{pattern}
 or two_classify like #{pattern} or three_classify like #{pattern}
 or item_brand_name like #{pattern}
	</select>
	<resultMap type="ItemInfo" id="itemInfoRM" autoMapping="true">
		<id property="itemId" column="item_id"/>
		<association property="itemDetail" javaType="ItemDetail">
			<id property="itemId" column="x_id"/>
			<result property="itemPica" column="item_pica"/>
		</association>
		<association property="itemBrand" javaType="ItemBrand">
			<id property="itemBrandId" column="item_brand_id"/>
			<result property="itemBrandName" column="item_brand_name"/>
		</association>
	</resultMap>
</mapper>       