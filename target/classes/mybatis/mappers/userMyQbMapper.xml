<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
       
<mapper namespace="com.yayiabc.http.mvc.dao.UserMyQbDao">
	<insert id="add" parameterType="QbRecord">
		INSERT INTO qb_record(user_id,qb_rget,qb_rout,qb_time,remark,created,updated)
		VALUE(#{userId},#{qbRget},#{qbRout},NOW(),#{remark},NOW(),NOW());
	</insert>
	
	<resultMap type="QbRecord" id="userMyQbRM">
		<id column="qb_rid" property="qbRid"/>
			<result column="user_id" property="userId"/>
			<result column="qb_rget" property="qbRget"/>
			<result column="qb_rout" property="qbRout"/>
			<result column="qb_time" property="qbTime"/>
			<result column="remark" property="remark"/>
		<association property="user" javaType="com.yayiabc.http.mvc.pojo.jpa.User">
			<id column="user_id" property="userId"/>
			<id column="qb_balance" property="qbBalance"/>
		</association>
	</resultMap>
	
	<select id="query" resultMap="userMyQbRM">
		 SELECT qb.user_id,qb.qb_rget,qb.qb_rout,qb.qb_time,qb.remark,u.qb_balance
         FROM qb_record qb
         LEFT JOIN USER u ON qb.user_id = u.user_id
         WHERE qb.user_id='${userId}'
         ORDER BY qb.qb_time DESC
         <if test="page.numberPerPage != 0">
            LIMIT ${page.currentNumber},${page.numberPerPage}
         </if>
	</select>
	
	<select id="queryRget" resultMap="userMyQbRM">
		 SELECT qb.user_id,qb.qb_rget,qb.qb_rout,qb.qb_time,qb.remark,u.qb_balance
         FROM qb_record qb
         LEFT JOIN USER u ON qb.user_id = u.user_id
	     WHERE qb.qb_rget !=0 AND qb.user_id='${userId}'
         <if test="page.numberPerPage != 0">
            LIMIT ${page.currentNumber},${page.numberPerPage}
         </if>
	</select>
	
	<select id="queryRout" resultMap="userMyQbRM">
		SELECT qb.user_id,qb.qb_rget,qb.qb_rout,qb.qb_time,qb.remark,u.qb_balance
        FROM qb_record qb
        LEFT JOIN USER u ON qb.user_id = u.user_id
	    WHERE qb.qb_rout !=0 AND qb.user_id='${userId}'
        <if test="page.numberPerPage != 0">
            LIMIT ${page.currentNumber},${page.numberPerPage}
        </if>
	</select>
	
	<select id="getCount" resultType="int">
		SELECT COUNT(*)
        FROM qb_record qb
        LEFT JOIN USER u ON qb.user_id = u.user_id
        WHERE qb.user_id='${userId}';
	</select>
	
	<select id="getCountRget" resultType="int">
		SELECT COUNT(*)
        FROM qb_record qb
        LEFT JOIN USER u ON qb.user_id = u.user_id
	    WHERE qb_rget !=0 AND qb.user_id='${userId}';
	</select>
	
	<select id="getCountRout" resultType="int">
		SELECT COUNT(*)
        FROM qb_record qb
        LEFT JOIN USER u ON qb.user_id = u.user_id
        WHERE qb_rout !=0 AND qb.user_id='${userId}';
	</select>
</mapper>        